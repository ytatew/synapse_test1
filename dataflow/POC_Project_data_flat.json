{
	"name": "POC_Project_data_flat",
	"properties": {
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "poc_project_flat",
						"type": "DatasetReference"
					},
					"name": "source1"
				}
			],
			"sinks": [
				{
					"name": "ProjectPhase"
				},
				{
					"name": "ProjectActivity"
				},
				{
					"name": "Task"
				},
				{
					"name": "ProjectActivityTask"
				},
				{
					"name": "ProjectPhseActivity"
				}
			],
			"transformations": [
				{
					"name": "flatten1"
				},
				{
					"name": "flatten2"
				},
				{
					"name": "flatten3"
				},
				{
					"name": "cast1"
				}
			],
			"scriptLines": [
				"source(output(",
				"          follow_id as string,",
				"          komoku as (comment as string, jisshikomoku as string, komoku_id as short, mokuhyochi as string)[],",
				"          project_id as integer,",
				"          shokomoku as (comment as string, komoku_id as short, naiyo as string, shokomoku_id as short, tanto_bumon as string)[],",
				"          shosai_jishijiko as (End as string, jishijiko_id as short, jisshikomoku as string, shokomoku_id as short, start as string)[]",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     ignoreNoFilesFound: false,",
				"     documentForm: 'singleDocument') ~> source1",
				"source1 foldDown(unroll(komoku),",
				"     mapColumn(",
				"          comment = komoku.comment,",
				"          jisshikomoku = komoku.jisshikomoku,",
				"          komoku_id = komoku.komoku_id,",
				"          mokuhyochi = komoku.mokuhyochi,",
				"          project_id",
				"     ),",
				"     skipDuplicateMapInputs: false,",
				"     skipDuplicateMapOutputs: false) ~> flatten1",
				"source1 foldDown(unroll(shokomoku),",
				"     mapColumn(",
				"          komoku_id = shokomoku.komoku_id,",
				"          naiyo = shokomoku.naiyo,",
				"          shokomoku_id = shokomoku.shokomoku_id,",
				"          tanto_bumon = shokomoku.tanto_bumon,",
				"          project_id",
				"     ),",
				"     skipDuplicateMapInputs: false,",
				"     skipDuplicateMapOutputs: false) ~> flatten2",
				"source1 foldDown(unroll(shosai_jishijiko),",
				"     mapColumn(",
				"          End = shosai_jishijiko.End,",
				"          jishijiko_id = shosai_jishijiko.jishijiko_id,",
				"          jisshikomoku = shosai_jishijiko.jisshikomoku,",
				"          shokomoku_id = shosai_jishijiko.shokomoku_id,",
				"          start = shosai_jishijiko.start,",
				"          project_id",
				"     ),",
				"     skipDuplicateMapInputs: false,",
				"     skipDuplicateMapOutputs: false) ~> flatten3",
				"flatten3 cast(output(",
				"          End as timestamp 'yyyy-MM-dd\\'T\\'HH:mm:ss',",
				"          jishijiko_id as integer,",
				"          jisshikomoku as string,",
				"          start as timestamp 'yyyy-MM-dd\\'T\\'HH:mm:ss'",
				"     ),",
				"     errors: true) ~> cast1",
				"flatten1 sink(allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     store: 'synapse',",
				"     databaseType: 'spark',",
				"     format: 'table',",
				"     database: 'POC_Database',",
				"     tableName: 'ProjectPhase',",
				"     input(",
				"          ProjectId as integer,",
				"          ProjectPhaseId as integer,",
				"          ProjectPhaseTypeId as integer,",
				"          ProjectPhaseName as string,",
				"          ProjectPhaseDescription as string,",
				"          ProjectPhasePlannedStartDate as date,",
				"          ProjectPhasePlannedFinishDate as date,",
				"          ProjectPhaseActualStartDate as date,",
				"          ProjectPhaseActualFinishDate as date",
				"     ),",
				"     mapColumn(",
				"          ProjectId = project_id,",
				"          ProjectPhaseId = komoku_id,",
				"          ProjectPhaseName = jisshikomoku,",
				"          ProjectPhaseDescription = mokuhyochi",
				"     )) ~> ProjectPhase",
				"flatten2 sink(allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     store: 'synapse',",
				"     databaseType: 'spark',",
				"     format: 'table',",
				"     database: 'POC_Database',",
				"     tableName: 'ProjectActivity',",
				"     input(",
				"          ProjectId as integer,",
				"          ActivityId as integer,",
				"          ActivityName as string,",
				"          ActivityDescription as string,",
				"          ActivityPlannedStartTimestamp as timestamp,",
				"          ActivityActualStartTimestamp as timestamp,",
				"          ActivityPlannedEndTimestamp as timestamp,",
				"          ActivityActualEndTimestamp as timestamp",
				"     ),",
				"     mapColumn(",
				"          ProjectId = project_id,",
				"          ActivityId = shokomoku_id,",
				"          ActivityName = naiyo",
				"     )) ~> ProjectActivity",
				"cast1 sink(allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     store: 'synapse',",
				"     databaseType: 'spark',",
				"     format: 'table',",
				"     database: 'POC_Database',",
				"     tableName: 'Task',",
				"     input(",
				"          TaskId as integer,",
				"          TaskName as string,",
				"          TaskDescription as string,",
				"          TaskSpecificationStatement as string,",
				"          SequenceNumber as integer,",
				"          MilestoneIndicator as boolean,",
				"          CriticalPathTaskIndicator as boolean,",
				"          TaskNote as string,",
				"          TaskPlannedStartTimestamp as timestamp,",
				"          TaskScheduledStartTimestamp as timestamp,",
				"          TaskActualStartTimestamp as timestamp,",
				"          TaskPlannedCompletionTimestamp as timestamp,",
				"          TaskScheduledCompletionTimestamp as timestamp,",
				"          TaskActualCompletionTimestamp as timestamp,",
				"          TaskEarliestStartTimestamp as timestamp,",
				"          TaskLatestStartTimestamp as timestamp,",
				"          TaskEarliestCompletionTimestamp as timestamp,",
				"          TaskLatestCompletionTimestamp as timestamp,",
				"          TaskFloatHours as integer,",
				"          PlannedBillableLaborUnits as integer,",
				"          ActualBillableLaborUnits as integer,",
				"          PlannedBillableChargesAmount as decimal(18,2),",
				"          ActualBillableChargesAmount as decimal(18,2),",
				"          PlannedCostsAmount as decimal(18,2),",
				"          ActualCostsAmount as decimal(18,2),",
				"          TaskTypeId as integer,",
				"          LocationId as integer,",
				"          ResponsibilityCenterId as integer,",
				"          TaskGlAccountNumber as string",
				"     ),",
				"     mapColumn(",
				"          TaskId = jishijiko_id,",
				"          TaskName = jisshikomoku,",
				"          TaskPlannedCompletionTimestamp = End,",
				"          TaskPlannedStartTimestamp = start",
				"     )) ~> Task",
				"flatten3 sink(allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     store: 'synapse',",
				"     databaseType: 'spark',",
				"     format: 'table',",
				"     database: 'POC_Database',",
				"     tableName: 'ProjectActivityTask',",
				"     input(",
				"          ProjectId as integer,",
				"          ActivityId as integer,",
				"          TaskId as integer,",
				"          ActivityTaskSequenceNumber as integer,",
				"          ActivityTaskNote as string",
				"     ),",
				"     mapColumn(",
				"          ProjectId = project_id,",
				"          ActivityId = shokomoku_id,",
				"          TaskId = jishijiko_id",
				"     )) ~> ProjectActivityTask",
				"flatten2 sink(allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     store: 'synapse',",
				"     databaseType: 'spark',",
				"     format: 'table',",
				"     database: 'POC_Database',",
				"     tableName: 'ProjectPhaseActivity',",
				"     input(",
				"          ProjectId as integer,",
				"          ProjectPhaseId as integer,",
				"          ActivityId as integer,",
				"          ProjectPhaseActivityNote as string",
				"     ),",
				"     mapColumn(",
				"          ProjectId = project_id,",
				"          ProjectPhaseId = komoku_id,",
				"          ActivityId = shokomoku_id",
				"     )) ~> ProjectPhseActivity"
			]
		}
	}
}